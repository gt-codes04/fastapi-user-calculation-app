<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Login</title>
</head>
<body>
  <h1>Login</h1>

  <p>
    <a href="/register-page">Go to Register</a> |
    <a href="/calculations-page">Go to Calculations</a> |
    <a href="/report-page">Go to Reports</a> |
    <a href="/profile-page">Go to Profile</a>
  </p>

  <div>
    <label for="email">Email:</label>
    <input id="email" name="email" type="email" />
  </div>

  <div>
    <label for="password">Password:</label>
    <input id="password" name="password" type="password" />
  </div>

  <button id="login-btn" type="button">Login</button>

  <p id="error" style="color: red;"></p>
  <p id="success" style="color: green;"></p>

  <script>
    const BASE_URL = "http://localhost:8000";

    async function handleLogin() {
      const emailEl = document.getElementById("email");
      const passwordEl = document.getElementById("password");
      const errorEl = document.getElementById("error");
      const successEl = document.getElementById("success");

      errorEl.textContent = "";
      successEl.textContent = "";

      const email = emailEl.value.trim();
      const password = passwordEl.value;

      if (!email || !password) {
        errorEl.textContent = "Email and password are required";
        return;
      }

      try {
        const resp = await fetch(`${BASE_URL}/users/login`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email, password })
        });

        if (!resp.ok) {
          if (resp.status === 401) {
            errorEl.textContent = "Invalid email or password";
          } else {
            errorEl.textContent = "Login failed. Please try again.";
          }
          return;
        }

        const data = await resp.json();

        // âœ… ALWAYS store token under key "token"
        if (data.access_token) {
          localStorage.setItem("token", data.access_token);
          // Optional: also set access_token for backwards compatibility
          localStorage.setItem("access_token", data.access_token);
        }

        // Optional: store user_id if needed
        if (data.user_id !== undefined) {
          localStorage.setItem("user_id", String(data.user_id));
        }

        successEl.textContent = "Login successful";
        console.log("Stored token:", localStorage.getItem("token"));

        // Redirect to calculations
        window.location.href = "/calculations-page";
      } catch (err) {
        console.error("Login error:", err);
        errorEl.textContent = "Login failed. Please try again.";
      }
    }

    document
      .getElementById("login-btn")
      .addEventListener("click", handleLogin);
  </script>
</body>
</html>



